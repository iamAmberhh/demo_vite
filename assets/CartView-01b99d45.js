import{E as k,r as p,o as i,c as d,b as n,d as e,F as b,j as x,k as y,t as u,w as P,e as r,f as S,i as E,l as f,v as I}from"./index-d6f7b654.js";import{_ as A}from"./_plugin-vue_export-helper-c27b6911.js";const{VITE_APP_API:m,VITE_APP_PATH:h}={VITE_APP_API:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"amberhh",BASE_URL:"/demo_vite/",MODE:"production",DEV:!1,PROD:!0},T={data(){return{isLoading:!1,cart:[],cartStatus:!1,loadingStatus:{loadingItem:"",isLoading:!1},user:{email:"",name:"",tel:"",address:""},message:""}},methods:{getCartList(){this.$http.get(`${m}v2/api/${h}/cart`).then(o=>{this.cart=o.data.data,this.cart.carts.length===0?this.cartStatus=!1:this.cartStatus=!0}).catch(o=>{alert(o.data.message)})},clearLoadingStatus(){this.loadingStatus.loadingItem="",this.loadingStatus.isLoading=!1},changeQty(o,t,v){const V={product_id:t,qty:v};this.$http.put(`${m}v2/api/${h}/cart/${o}`,{data:V}).then(()=>{alert("已更新產品數量"),this.getCartList()}).catch(s=>{alert(s.data.message)})},removeCartItem(o){this.loadingStatus.loadingItem=o,this.loadingStatus.isLoading=!0,this.$http.delete(`${m}v2/api/${h}/cart/${o}`).then(()=>{alert("已刪除購物車品項"),this.getCartList(),this.clearLoadingStatus()}).catch(t=>{alert(t.data.message)})},removeAllCart(){this.$http.delete(`${m}v2/api/${h}/carts`).then(()=>{alert("已清空購物車"),this.getCartList()}).catch(o=>{alert(o.data.message)})},isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的手機號碼"},onSubmit(){const o={user:this.user,message:this.message};if(this.cart.carts.length===0){alert("購物車內還沒有商品唷～");return}this.$http.post(`${m}v2/api/${h}/order`,{data:o}).then(t=>{alert(t.data.message),this.$refs.form.resetForm(),this.message="",this.getCartList()}).catch(t=>{alert(t.data.message)})}},mounted(){this.getCartList(),this.isLoading=!0,setTimeout(()=>{this.isLoading=!1},2e3)},components:{ErrorMessage:k}},U={class:"container"},w={key:0,class:"text-center"},F=e("p",null,"購物車內還沒有商品，快去選購吧！",-1),q=[F],M={key:1},N={class:"text-end"},D=["disabled"],B={class:"table align-middle"},j=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價"),e("th",null,"小計")])],-1),H=["onClick","disabled"],O={key:0,class:"fas fa-spinner fa-pulse"},Q=e("div",{class:"text-success"},"已套用優惠券",-1),R={class:"input-group input-group-sm"},z={class:"input-group mb-3"},$=["onUpdate:modelValue","onChange"],G=["value"],J={class:"text-end"},K={class:"text-end"},W=e("td",{colspan:"4",class:"text-end"},"總計",-1),X={class:"text-end"},Y=e("hr",{class:"my-2"},null,-1),Z={class:"my-5 row justify-content-center"},ee={class:"mb-3"},te=e("label",{for:"email",class:"form-label"},[r("Email"),e("span",{class:"ms-1 text-danger"},"*")],-1),se={class:"mb-3"},ae=e("label",{for:"name",class:"form-label"},[r("收件人姓名"),e("span",{class:"ms-1 text-danger"},"*")],-1),le={class:"mb-3"},oe=e("label",{for:"tel",class:"form-label"},[r("收件人電話"),e("span",{class:"ms-1 text-danger"},"*")],-1),ne={class:"mb-3"},ie=e("label",{for:"address",class:"form-label"},[r("收件人地址"),e("span",{class:"ms-1 text-danger"},"*")],-1),de={class:"mb-3"},re=e("label",{for:"message",class:"form-label"},"留言",-1),ce=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function ue(o,t,v,V,s,c){const L=p("VueLoading"),_=p("VField"),g=p("ErrorMessage"),C=p("VForm");return i(),d(b,null,[n(L,{active:s.isLoading,"onUpdate:active":t[0]||(t[0]=a=>s.isLoading=a)},null,8,["active"]),e("div",U,[s.cartStatus?(i(),d("div",M,[e("div",N,[e("button",{class:"btn btn-outline-danger",type:"button",disabled:!s.cartStatus,onClick:t[1]||(t[1]=a=>c.removeAllCart())}," 清空購物車 ",8,D)]),e("table",B,[j,e("tbody",null,[s.cart.carts?(i(!0),d(b,{key:0},x(s.cart.carts,a=>(i(),d("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:l=>c.removeCartItem(a.id),disabled:s.loadingStatus.loadingItem===a.id&&s.loadingStatus.isLoading},[s.loadingStatus.loadingItem===a.id?(i(),d("i",O)):y("",!0),r(" x ")],8,H)]),e("td",null,[r(u(a.product.title)+" ",1),Q]),e("td",null,[e("div",R,[e("div",z,[S(e("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":l=>a.qty=l,onChange:l=>c.changeQty(a.id,a.product_id,a.qty)},[(i(),d(b,null,x(20,l=>e("option",{value:l,key:l},u(l),9,G)),64))],40,$),[[E,a.qty]])])])]),e("td",J,u(a.product.price),1),e("td",K,u(a.final_total),1)]))),128)):y("",!0)]),e("tfoot",null,[e("tr",null,[W,e("td",X,u(s.cart.final_total),1)])])])])):(i(),d("div",w,q)),Y,e("div",Z,[n(C,{ref:"form",class:"col-md-6",onSubmit:c.onSubmit},{default:P(({errors:a})=>[e("div",ee,[te,n(_,{id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:s.user.email,"onUpdate:modelValue":t[2]||(t[2]=l=>s.user.email=l)},null,8,["class","modelValue"]),n(g,{name:"email",class:"invalid-feedback"})]),e("div",se,[ae,n(_,{id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:s.user.name,"onUpdate:modelValue":t[3]||(t[3]=l=>s.user.name=l)},null,8,["class","modelValue"]),n(g,{name:"姓名",class:"invalid-feedback"})]),e("div",le,[oe,n(_,{id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:c.isPhone,modelValue:s.user.tel,"onUpdate:modelValue":t[4]||(t[4]=l=>s.user.tel=l)},null,8,["class","rules","modelValue"]),n(g,{name:"電話",class:"invalid-feedback"})]),e("div",ne,[ie,n(_,{id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:s.user.address,"onUpdate:modelValue":t[5]||(t[5]=l=>s.user.address=l)},null,8,["class","modelValue"]),n(g,{name:"地址",class:"invalid-feedback"})]),e("div",de,[re,S(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[6]||(t[6]=l=>s.message=l)},null,512),[[I,s.message]])]),ce]),_:1},8,["onSubmit"])])])],64)}const _e=A(T,[["render",ue]]);export{_e as default};
